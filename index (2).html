// Staff data and users
let staffData = [];
let users = [];

// Storage abstraction - works in both sandbox and GitHub Pages
const storage = {
  data: {},
  getItem: function(key) {
      try {
          return localStorage.getItem(key);
      } catch(e) {
          return this.data[key] || null;
      }
  },
  setItem: function(key, value) {
      try {
          localStorage.setItem(key, value);
      } catch(e) {
          this.data[key] = value;
      }
  },
  removeItem: function(key) {
      try {
          localStorage.removeItem(key);
      } catch(e) {
          delete this.data[key];
      }
  }
};

// Check if localStorage is available
console.log('=== CHECKING LOCALSTORAGE ===');
try {
  storage.setItem('_test', '1');
  storage.removeItem('_test');
  console.log('✓ localStorage is AVAILABLE');
} catch(e) {
  console.error('✗ localStorage BLOCKED:', e);
  // Don't show alert - it may be a false positive on GitHub Pages
}

// Initialize staff data on page load
function initializeStaffData() {
  console.log('=== INITIALIZING STAFF DATA ===');
  
  // Try to load from localStorage
  try {
    const savedData = storage.getItem('staffData');
    console.log('localStorage check:', savedData ? `DATA FOUND (${savedData.length} chars)` : 'NO DATA');
    
    if (savedData) {
      const parsed = JSON.parse(savedData);
      if (Array.isArray(parsed) && parsed.length > 0) {
        staffData = parsed;
        console.log('✓ LOADED FROM LOCALSTORAGE:', staffData.length, 'staff members');
        console.log('✓ First member:', staffData[0].atlasId, '-', staffData[0].contact.phone);
        return; // STOP - successfully loaded
      }
    }
  } catch(e) {
    console.error('Error loading from localStorage:', e);
  }
  
  // Load defaults if no saved data
  console.log('No saved data - loading defaults');
  staffData = [
  {
    id: 20,
    name: 'David ADAM',
    position: 'Contractor',
    atlasId: 'ADAMDavid',
    state: 'NSW',
    teamStatus: 'Active',
    dateOfBirth: '12-Mar-1960',
    contact: {
      email: 'auskie1@optusnet.com.au',
      phone: '0409-992-215',
      address: '23 Picasso Cresent, Old Toongabbie, NSW, 2146',
      emergencyContact: 'Not pro